# 10-4. 세그먼트 트리

### 세그먼트 트리

- 주어진 데이터들의 구간 합과 데이터 업데이트를 빠르게 수행하기 위해 고안해 낸 자료구조의 형태
- 더 큰 범위는 '인덱스 트리'라고 불리는데, 코딩 테스트 영역에서는 큰 차이가 없다.

<br />

### 핵심 이론

- 세그먼트 트리의 종류는 구간 합, 최대 ・ 최소 구하기로 나눌 수 있다.
- 구현 단계는 트리 초기화하기, 질의값 구하기(구간 합 또는 최대 ・ 최소), 데이터 업데이트하기로 나눌 수 있다.

<br />

### 구현 과정

1. 트리 초기화하기

- 리프 노드의 개수가 데이터의 개수(N) 이상이 되도록 트리 배열을 만든다.
- 트리 배열의 크기는 $2^k >= N$ 을 만족하는 k의 최솟값을 구한 후 $2^k * 2$를 트리 배열의 크기로 정의한다.
- 리프 노드에 원본 데이터를 입력한다. 이때 리프 노드의 시작 위치를 트리 배열의 인덱스로 구해야 하는데, $2^k$을 시작 인덱스로 취하면 된다.
- 리프 노드를 제외한 나머지 노드의 값을 채운다 ($2^k - 1$ 부터 1번 쪽으로 채운다).  
  채워야 하는 인덱스가 N이라고 가정하면 자신의 자식 노드를 이용해 해당 값을 채울 수 있다.
- 자식 노드의 인덱스는 이진 트리 형식이기 때문에 2N, 2N+1 이 된다.

2. 질의값 구하기

- 주어진 질의 인덱스를 세그먼트 트리의 리프 노드에 해당하는 인덱스로 변경한다.  
  (기존 샘플을 기준으로 한 인덱스값과 세그먼트 트리 배열에서의 인덱스값이 다르기 때문에 인덱스를 변경해야 한다.)
- 질의 인덱스를 세그먼트 트리 인덱스로 변경하는 방법 : $세그먼트 트리 index = 주어진 질의 index + 2^k - 1$
- 질의에서의 시작 인덱스와 종료 인덱스에 관해 부모 노드로 이동하면서 주어진 질의에 해당하는 값을 다음과 같이 구한다.
  1.  start_index % 2 == 1 일 때 해당 노드를 선택한다.
  2.  end_index % 2 == 0 일 때 해당 노드를 선택한다.
  3.  start_index depth 변경 → start_index = (start_index + 1) / 2 연산을 실행한다.
  4.  end_index depth 변경 → end_index = (end_index - 1) / 2 연산을 실행한다.
  5.  1 ~ 4를 반복하다가 end_index < start_index가 되면 종료한다.
- 질의에 해당하는 노드를 연산하는 방법 (질의에 해당하는 노드를 선택하는 방법은 모두 동일)
  - 구간 합 : 선택된 노드들을 모두 더하여 출력한다.
  - 최댓값 구하기 : 선택된 노드들 중 MAX 값을 선택해 출력한다.
  - 최솟값 구하기 : 선택된 노드들 중 MIN 값을 선택해 출력한다.

<br />

### 예제 문제

- [문제074. 구간 합 구하기3](./문제074.%20구간%20합%20구하기3.md)
- [문제075. 최솟값 찾기2](./문제075.%20최솟값찾기2.md)
- [문제076. 구간 곱 구하기](./문제076.%20구간%20곱%20구하기.md)
